# 大文件上传

## 交代背景

在聊天应用中，需要上传文件

## 问题

- 网络断开后，之前上传的文件，需要重新上传
- 传着传着，网络波动啥都没有了
- 没电关机了，想接着传，做不到

专业术语对应：
- 断点续传
- 断开重连重传
- 切片上传

## 方案

- 前端切片 chunk 1024M（1048576K），500K，const size = 1048576 / 500; // 分片数量
- 将切片传递给后代，切片要取名：hash + index
- 后端组合切片

## 加料

- 前端切片：主进程做切片会卡顿，使用 web-worker 多线程切片，处理完后交给主进程发送给后端
- 切完后，将 blob 存储到 indexdb中，下次用户进来后，判断一下是否存在未完成上传的切片，有就尝试继续上传
- websocket 实时上传进度，实时通知，和请求序列控制
- 整体说大文件上传设计
    - 组件设计
    - props、事件、状态
    - 拖拽上传、多文件选择
    - 通用化不同文件的上传

## 具体实现